{"version":3,"file":"hip412-metadata-schema.js","names":["_isImageFile","require","_isString","_interopRequireDefault","_zod","_dictionary","_mimeTypesAndExtensions","obj","__esModule","default","AttributeSchema","z","object","trait_type","string","display_type","optional","value","union","min","number","boolean","max_value","LocalizationSchema","uri","locales","array","FileSchema","type","refine","KNOWN_IMAGE_MIME_TYPES","some","knownType","startsWith","message","dictionary","validation","unsupportedImageMimeType","metadata","recursiveSchema","checksum","is_default_file","metadata_uri","Hip412MetadataCommonSchema","exports","name","description","creator","creatorDID","files","format","properties","record","unknown","attributes","localization","imageForHip412MetadataSchema","custom","superRefine","ctx","isString","length","addIssue","fatal","code","ZodIssueCode","imageForNftNotFound","filePath","isImageFile","mimeType","mediaFileNotSupported","lazy","Hip412MetadataSchema","image"],"sources":["../../../../src/utils/validation-schemas/hip412-metadata-schema.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2024 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport { isImageFile } from '../../helpers/is-image-file';\nimport type { BufferFile } from '../../types/buffer-file';\nimport isString from 'lodash/isString';\nimport { type ZodTypeAny, z } from 'zod';\nimport { dictionary } from '../constants/dictionary';\nimport { KNOWN_IMAGE_MIME_TYPES } from '../constants/mime-types-and-extensions';\n\nconst AttributeSchema = z.object({\n  trait_type: z.string(),\n  display_type: z.string().optional(),\n  value: z.union([z.string().min(1), z.number(), z.boolean()]),\n  max_value: z.union([z.string(), z.number()]).optional(),\n});\n\nconst LocalizationSchema = z.object({\n  uri: z.string(),\n  default: z.string(),\n  locales: z.array(z.string()),\n});\n\nconst FileSchema = z.object({\n  uri: z.string(),\n  type: z.string().refine((value) => KNOWN_IMAGE_MIME_TYPES.some((knownType) => value.startsWith(knownType)), {\n    message: dictionary.validation.unsupportedImageMimeType,\n  }),\n  metadata: recursiveSchema().optional(),\n  checksum: z.string().optional(),\n  is_default_file: z.boolean().optional(),\n  metadata_uri: z.string().optional(),\n});\n\nexport const Hip412MetadataCommonSchema = {\n  name: z.string().min(1),\n  description: z.string().optional(),\n  creator: z.string().optional(),\n  creatorDID: z.string().optional(),\n  checksum: z.string().optional(),\n  type: z.string().refine((value) => KNOWN_IMAGE_MIME_TYPES.some((knownType) => value.startsWith(knownType)), {\n    message: dictionary.validation.unsupportedImageMimeType,\n  }),\n  files: z.array(FileSchema).optional(),\n  format: z.optional(z.string()),\n  properties: z.record(z.unknown()).optional(),\n  attributes: z.array(AttributeSchema).optional(),\n  localization: LocalizationSchema.optional(),\n};\n\nexport const imageForHip412MetadataSchema = z.custom<string | BufferFile | undefined>().superRefine((value, ctx) => {\n  if (!value || (isString(value) && !value.length)) {\n    ctx.addIssue({\n      fatal: true,\n      code: z.ZodIssueCode.custom,\n      message: dictionary.validation.imageForNftNotFound,\n    });\n    return false;\n  }\n\n  if (!isString(value) && value.filePath && !isImageFile(value.name, value.mimeType)) {\n    ctx.addIssue({\n      fatal: true,\n      code: z.ZodIssueCode.custom,\n      message: dictionary.validation.mediaFileNotSupported,\n    });\n    return false;\n  }\n\n  return true;\n});\n\nfunction recursiveSchema(): ZodTypeAny {\n  return z.lazy(() => z.object(Hip412MetadataCommonSchema));\n}\n\nexport const Hip412MetadataSchema = z.object({\n  ...Hip412MetadataCommonSchema,\n  image: imageForHip412MetadataSchema,\n});\n"],"mappings":"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","ignoreList":[]}