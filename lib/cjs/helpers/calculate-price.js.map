{"version":3,"file":"calculate-price.js","names":["math","_interopRequireWildcard","require","_feeTool","_feeToolConfig","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","FeeTool","model","NUM_NODES","CONSTANT_TERM_WEIGHT","PRICE_PRECISION","FEE_SCHEDULE_MULTIPLIER","USD_TO_TINYCENTS","constructor","apis","config","getCreateTokenCost","usage","price","CREATE_TOKEN_NON_FUNGIBLE_UNIQUE","Number","calculatePrice","getCreateTokenWithFeesCost","CREATE_TOKEN_NON_FUNGIBLE_UNIQUE_WITH_CUSTOM_FEES","calculateUsage","customUsage","apiFormulae","INITIAL_HEDERA_USAGE","updateUsageAutoRenewAccountSet","valuesForFormulaExecution","CONSTANTS_FOR_FORMULAE","increaseInitialUsageWithCustomUsage","formulae","entries","forEach","_ref","feeComponent","items","_ref2","item","formula","validFeeComponent","usageItem","compiledFormula","parse","compile","undefined","evaluate","isAutoRenewAccountSet","sumHederaUsage","usage1","usage2","usageComponents","usageKeys","sum","component","subKey","value1","value2","actualUsage","usageSum","feeSchedules","normalizedPrice","toFixed","exports"],"sources":["../../../src/helpers/calculate-price.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2024 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport {\n  FeeToolConfig,\n  Formulae,\n  HederaUsage,\n  TokenCreateUsage,\n  TokenCreateWithFeesUsage,\n  Usage,\n  UsageComponents,\n  UsageKeys,\n} from '../types/estimate-create-collection';\nimport * as math from 'mathjs';\nimport {\n  CONSTANT_TERM_WEIGHT,\n  CONSTANTS_FOR_FORMULAE,\n  FEE_SCHEDULE_MULTIPLIER,\n  INITIAL_HEDERA_USAGE,\n  NUM_NODES,\n  PRICE_PRECISION,\n  USD_TO_TINYCENTS,\n} from '../utils/constants/fee-tool';\nimport { CREATE_TOKEN_NON_FUNGIBLE_UNIQUE, CREATE_TOKEN_NON_FUNGIBLE_UNIQUE_WITH_CUSTOM_FEES } from '../utils/constants/fee-tool-config';\n\nexport class FeeTool {\n  private config: FeeToolConfig;\n  private static model = {\n    NUM_NODES,\n    CONSTANT_TERM_WEIGHT,\n    PRICE_PRECISION,\n    FEE_SCHEDULE_MULTIPLIER,\n    USD_TO_TINYCENTS,\n  };\n\n  private constructor(apis: FeeToolConfig) {\n    this.config = apis;\n  }\n\n  static getCreateTokenCost = (usage: TokenCreateUsage): number => {\n    const price = new FeeTool(CREATE_TOKEN_NON_FUNGIBLE_UNIQUE);\n    return Number(price.calculatePrice(usage).price);\n  };\n\n  static getCreateTokenWithFeesCost = (usage: TokenCreateWithFeesUsage): number => {\n    const price = new FeeTool(CREATE_TOKEN_NON_FUNGIBLE_UNIQUE_WITH_CUSTOM_FEES);\n    return Number(price.calculatePrice(usage).price);\n  };\n\n  private calculateUsage(customUsage: Usage, apiFormulae: Formulae): HederaUsage {\n    const usage: HederaUsage = INITIAL_HEDERA_USAGE;\n\n    this.updateUsageAutoRenewAccountSet(customUsage);\n\n    const valuesForFormulaExecution: typeof CONSTANTS_FOR_FORMULAE & Usage = {\n      ...customUsage,\n      ...CONSTANTS_FOR_FORMULAE,\n    };\n\n    return this.increaseInitialUsageWithCustomUsage(apiFormulae, usage, valuesForFormulaExecution);\n  }\n\n  private increaseInitialUsageWithCustomUsage(\n    formulae: Formulae,\n    usage: HederaUsage,\n    valuesForFormulaExecution: typeof CONSTANTS_FOR_FORMULAE & Usage\n  ): HederaUsage {\n    Object.entries(formulae).forEach(([feeComponent, items]) => {\n      Object.entries(items).forEach(([item, formula]) => {\n        const validFeeComponent = feeComponent as UsageComponents;\n        const usageItem = item as UsageKeys;\n        const compiledFormula = math.parse(formula).compile();\n\n        if (usage[validFeeComponent][usageItem] === undefined || usage[validFeeComponent][usageItem] === null) {\n          return;\n        }\n        usage[validFeeComponent][usageItem] = compiledFormula.evaluate(valuesForFormulaExecution);\n      });\n    });\n\n    return usage;\n  }\n\n  private updateUsageAutoRenewAccountSet(usage: Usage): void {\n    if ('isAutoRenewAccountSet' in usage && typeof usage.isAutoRenewAccountSet === 'boolean') {\n      usage.isAutoRenewAccountSet = usage.isAutoRenewAccountSet ? 1 : 0;\n    }\n  }\n\n  private sumHederaUsage(usage1: HederaUsage, usage2: HederaUsage): number {\n    const usageComponents = ['node', 'network', 'service'];\n    const usageKeys = ['constant', 'bpt', 'vpt', 'rbh', 'sbh', 'gas', 'bpr', 'sbpr', 'min', 'max'];\n    let sum = 0;\n\n    for (const component of usageComponents as UsageComponents[]) {\n      for (const subKey of usageKeys as UsageKeys[]) {\n        const value1 = usage1[component][subKey];\n        const value2 = usage2[component][subKey];\n        if (value1 && value2) {\n          sum = sum + value1 * value2;\n        }\n      }\n    }\n\n    return sum;\n  }\n\n  private calculatePrice(customUsage: Usage): {\n    usage: HederaUsage;\n    price: string;\n  } {\n    const actualUsage = this.calculateUsage(customUsage, this.config.formulae);\n    const usageSum = this.sumHederaUsage(this.config.feeSchedules, actualUsage);\n    const normalizedPrice = math.evaluate(`${usageSum} / (${FeeTool.model.FEE_SCHEDULE_MULTIPLIER} * ${FeeTool.model.USD_TO_TINYCENTS})`);\n\n    return {\n      usage: actualUsage,\n      price: normalizedPrice.toFixed(FeeTool.model.PRICE_PRECISION),\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}