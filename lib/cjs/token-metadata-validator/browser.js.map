{"version":3,"file":"browser.js","names":["_hip412MetadataSchema","require","_validateObjectWithSchema","_errorToMessage","_mirrorNode","_uriDecoder","_validationError","_getNftMetadatasFromCollection","TokenMetadataValidator","validateSingleMetadataObject","object","errors","validateObjectWithSchema","Hip412MetadataSchema","validationMetadataErrorOptions","err","ValidationError","push","errorToMessage","isValid","length","validateArrayOfObjects","metadataObjects","results","allObjectsValid","forEach","metadataObject","index","e","errorMessage","errorsCount","map","error","validateLocalFile","_","Error","validateLocalDirectory","validateOnChainArrayOfObjects","obj","serialNumber","message","metadata","validateMetadataFromOnChainCollection","network","tokenId","ipfsGateway","limit","arguments","undefined","getNftMetadataFromCollection","validateSingleOnChainNFTMetadata","nft","getSingleNFTDetails","decodedNFTMetadataURL","uriDecoder","getMetadataObjectsForValidation","general","missingAttributes","exports"],"sources":["../../../src/token-metadata-validator/browser.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2024 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport { NetworkName } from '@hashgraph/sdk/lib/client/Client';\nimport { Hip412MetadataSchema } from '../utils/validation-schemas/hip412-metadata-schema';\nimport { validateObjectWithSchema, validationMetadataErrorOptions } from '../helpers/validate-object-with-schema';\nimport { errorToMessage } from '../helpers/error-to-message';\nimport { MetadataObject } from '../types/csv';\nimport { getMetadataObjectsForValidation, getSingleNFTDetails, MetadataFromMirrorNode } from '../api/mirror-node';\nimport { uriDecoder } from '../helpers/uri-decoder';\nimport { ValidationError } from '../utils/validation-error';\nimport { getNftMetadataFromCollection } from '../helpers/get-nft-metadatas-from-collection';\nimport { NFTMetadata } from '../types/nft-metadata';\nimport {\n  FileValidationResult,\n  DetailedFileValidationResult,\n  ValidateArrayOfObjectsResult,\n  DirectoryValidationResult,\n} from '../types/hip412-validator';\n\nexport class TokenMetadataValidator {\n  static validateSingleMetadataObject(object: MetadataObject | NFTMetadata): FileValidationResult {\n    const errors: string[] = [];\n\n    try {\n      validateObjectWithSchema(Hip412MetadataSchema, object, validationMetadataErrorOptions);\n    } catch (err) {\n      if (err instanceof ValidationError) {\n        errors.push(...err.errors);\n      } else {\n        errors.push(errorToMessage(err));\n      }\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n    };\n  }\n\n  static validateArrayOfObjects(metadataObjects: MetadataObject[]): ValidateArrayOfObjectsResult {\n    const results: { [index: number]: DetailedFileValidationResult } = {};\n    let allObjectsValid = true;\n\n    metadataObjects.forEach((metadataObject, index) => {\n      const errors: string[] = [];\n      try {\n        validateObjectWithSchema(Hip412MetadataSchema, metadataObject, validationMetadataErrorOptions);\n      } catch (e) {\n        allObjectsValid = false;\n        const errorMessage = errorToMessage(e);\n        if (e instanceof ValidationError) {\n          errors.push(...e.errors);\n        } else {\n          errors.push(errorMessage);\n        }\n      }\n      results[index] = {\n        isValid: errors.length === 0,\n        errorsCount: errors.length,\n        errors: errors.map((error) => error),\n      };\n    });\n\n    return {\n      allObjectsValid,\n      results,\n    };\n  }\n\n  static validateLocalFile(_: string): FileValidationResult {\n    throw new Error(\"No available in browser\")\n  }\n\n  static validateLocalDirectory(_: string): DirectoryValidationResult {\n    throw new Error('No available in browser');\n  }\n\n  static validateOnChainArrayOfObjects = (\n    metadataObjects: Awaited<MetadataFromMirrorNode>[]\n  ): { isValid: boolean; errors: Array<{ serialNumber: number; message: string[] }> } => {\n    const errors: Array<{ serialNumber: number; message: string[] }> = [];\n\n    metadataObjects.forEach((obj) => {\n      if (obj.error) {\n        errors.push({\n          serialNumber: obj.serialNumber,\n          message: [obj.error],\n        });\n      } else if (obj.metadata) {\n        try {\n          validateObjectWithSchema(Hip412MetadataSchema, obj.metadata, validationMetadataErrorOptions);\n        } catch (e) {\n          errors.push({\n            serialNumber: obj.serialNumber,\n            message: [errorToMessage(e)],\n          });\n        }\n      }\n    });\n\n    return { isValid: errors.length === 0, errors };\n  };\n\n  static async validateMetadataFromOnChainCollection(network: NetworkName, tokenId: string, ipfsGateway?: string, limit: number = 100) {\n    const metadataObjects = await getNftMetadataFromCollection(network, tokenId, limit, ipfsGateway);\n\n    return TokenMetadataValidator.validateOnChainArrayOfObjects(metadataObjects);\n  }\n\n  static async validateSingleOnChainNFTMetadata(network: NetworkName, tokenId: string, serialNumber: number, ipfsGateway?: string) {\n    const nft = await getSingleNFTDetails(network, tokenId, serialNumber);\n    const decodedNFTMetadataURL = uriDecoder(nft, ipfsGateway);\n\n    const metadataObject = await getMetadataObjectsForValidation(decodedNFTMetadataURL[0].metadata, decodedNFTMetadataURL[0].serialNumber);\n\n    if (!metadataObject.metadata) {\n      return {\n        isValid: false,\n        errors: {\n          general: [metadataObject.error],\n          missingAttributes: [],\n        },\n      };\n    }\n    return TokenMetadataValidator.validateSingleMetadataObject(metadataObject.metadata);\n  }\n}\n"],"mappings":"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","ignoreList":[]}