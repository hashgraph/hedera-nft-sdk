{"version":3,"file":"index.js","names":["_axios","_interopRequireDefault","require","_getMirrorNodeUrlForNetwork","obj","__esModule","default","defaultWeights","exports","keys","admin_key","wipe_key","freeze_key","supply_key","kyc_key","pause_key","fee_schedule_key","properties","supply_type_infinite","defaultRiskLevels","NORISK","LOW","MEDIUM","HIGH","calculateRiskScoreFromData","_ref","metadata","customWeights","customRiskLevels","riskScore","riskScoreFactors","calculateRiskScore","riskLevel","calculateRiskLevel","score","calculateRiskScoreFromTokenId","_ref2","tokenId","network","localNodeURL","uri","getMirrorNodeUrlForNetwork","Error","data","axios","get","weights","key","typedKey","supply_type","Number","max_supply","total_supply","_ref3","riskLevels"],"sources":["../../../src/risk/index.ts"],"sourcesContent":["/*\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2023 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport axios from 'axios';\nimport { Metadata, RiskResult, Weights, KeyTypes, RiskLevels, RiskLevel, RiskScoreFactors } from '../types/risk';\nimport { getMirrorNodeUrlForNetwork } from '../utils/hedera/get-mirror-node-url-for-network';\n\ntype Network = 'mainnet' | 'testnet' | 'previewnet' | 'localNode';\n\n// Default weights for risk score calculation\nconst defaultWeights: Weights = {\n  keys: {\n    admin_key: 200,\n    wipe_key: 200,\n    freeze_key: 50,\n    supply_key: 20,\n    kyc_key: 50,\n    pause_key: 50,\n    fee_schedule_key: 40,\n  },\n  properties: {\n    supply_type_infinite: 20,\n  },\n};\n\n// Default thresholds for risk level calculation\nconst defaultRiskLevels: RiskLevels = {\n  NORISK: 0,\n  LOW: 40,\n  MEDIUM: 199,\n  HIGH: 200,\n};\n\nconst calculateRiskScoreFromData = ({\n  metadata,\n  customWeights,\n  customRiskLevels,\n}: {\n  metadata: Metadata;\n  customWeights?: Weights;\n  customRiskLevels?: RiskLevels;\n}): RiskResult => {\n  const { riskScore, riskScoreFactors } = calculateRiskScore(metadata, customWeights);\n  const riskLevel = calculateRiskLevel({ score: riskScore, customRiskLevels });\n\n  return {\n    riskScore,\n    riskLevel,\n    riskScoreFactors,\n  };\n};\n\nconst calculateRiskScoreFromTokenId = async ({\n  tokenId,\n  network = 'mainnet',\n  localNodeURL,\n  customWeights,\n  customRiskLevels,\n}: {\n  tokenId: string;\n  network?: Network;\n  localNodeURL?: string;\n  customWeights?: Weights;\n  customRiskLevels?: RiskLevels;\n}): Promise<RiskResult> => {\n  let uri = '';\n\n  switch (network) {\n    case 'mainnet':\n      uri = `${getMirrorNodeUrlForNetwork('mainnet')}/tokens/${tokenId}/`;\n      break;\n    case 'testnet':\n      uri = `${getMirrorNodeUrlForNetwork('testnet')}/tokens/${tokenId}/`;\n      break;\n    case 'previewnet':\n      uri = `${getMirrorNodeUrlForNetwork('previewnet')}/tokens/${tokenId}/`;\n      break;\n    case 'localNode':\n      if (!localNodeURL) {\n        throw new Error('localNodeURL is required for local node network');\n      }\n      uri = `${localNodeURL}/api/v1/tokens/${tokenId}/`;\n      break;\n    default:\n      throw new Error('Invalid network');\n  }\n\n  const { data: metadata } = await axios.get<Metadata>(uri);\n\n  const { riskScore, riskScoreFactors } = calculateRiskScore(metadata, customWeights);\n  const riskLevel = calculateRiskLevel({ score: riskScore, customRiskLevels });\n\n  return {\n    riskScore,\n    riskLevel,\n    riskScoreFactors,\n  };\n};\n\nconst calculateRiskScore = (metadata: Metadata, customWeights?: Weights): { riskScore: number; riskScoreFactors: RiskScoreFactors } => {\n  const weights = customWeights ? customWeights : defaultWeights;\n  let riskScore = 0;\n  const riskScoreFactors: RiskScoreFactors = {};\n\n  // Iterate through the properties of the object\n  for (const key in metadata) {\n    const typedKey = key as KeyTypes;\n\n    // Check if the property is present in the weights object and not null\n    if (metadata[typedKey] && (typedKey as KeyTypes) in weights.keys) {\n      // If it is, add the associated risk weight to the risk score\n      riskScore += weights.keys[typedKey as KeyTypes];\n      riskScoreFactors[typedKey as KeyTypes] = weights.keys[typedKey as KeyTypes];\n    }\n  }\n\n  if (metadata.supply_type === 'INFINITE' && metadata.supply_key) {\n    riskScore += weights.properties.supply_type_infinite;\n    riskScoreFactors['supply_type_infinite_and_supply_key_defined'] = weights.properties.supply_type_infinite;\n  }\n\n  if (metadata.supply_type === 'FINITE' && Number(metadata.max_supply) == Number(metadata.total_supply)) {\n    riskScore -= weights.keys.supply_key;\n    riskScoreFactors['max_supply_equal_to_total_supply'] = -weights.keys.supply_key;\n  }\n\n  return { riskScore, riskScoreFactors };\n};\n\nconst calculateRiskLevel = ({ score, customRiskLevels }: { score: number; customRiskLevels?: RiskLevels }): RiskLevel => {\n  const riskLevels = customRiskLevels || defaultRiskLevels;\n\n  if (score <= riskLevels.NORISK) {\n    return 'NO RISK';\n  } else if (score <= riskLevels.LOW) {\n    return 'LOW';\n  } else if (score <= riskLevels.MEDIUM) {\n    return 'MEDIUM';\n  } else {\n    return 'HIGH';\n  }\n};\n\nexport {\n  defaultWeights,\n  defaultRiskLevels,\n  calculateRiskScoreFromData,\n  calculateRiskScoreFromTokenId,\n  calculateRiskLevel, // built-in in \"calculateRiskScore\" functions\n};\n"],"mappings":"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","ignoreList":[]}