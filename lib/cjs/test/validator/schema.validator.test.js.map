{"version":3,"file":"schema.validator.test.js","names":["_validHIP","_interopRequireDefault","require","obj","__esModule","default","Validator","defaultSchemaVersion","schemaValidator","describe","test","validator","schema","getSchema","metadata","JSON","parse","stringify","validMetadata","schemaProblems","expect","Array","isArray","errors","toBe","warnings","length","attributes","checksum","trait_type","value","type","msg","path"],"sources":["../../../../src/test/validator/schema.validator.test.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2023 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nconst { Validator, defaultSchemaVersion } = require('../../validator/index');\nconst { schemaValidator } = require('../../validator/validators/schema');\nimport validMetadata from './data/valid-HIP412';\n\ndescribe('Schema validator tests', () => {\n  test('it should not return errors or warnings for a correct JSON schema', () => {\n    // Arrange\n    const validator = new Validator();\n    const schema = validator.getSchema(defaultSchemaVersion);\n\n    const metadata = JSON.parse(JSON.stringify(validMetadata));\n\n    // Act\n    const schemaProblems = schemaValidator(metadata, schema);\n\n    // Assert\n    expect(Array.isArray(schemaProblems.errors)).toBe(true);\n    expect(Array.isArray(schemaProblems.warnings)).toBe(true);\n    expect(schemaProblems.warnings.length).toBe(0);\n    expect(schemaProblems.errors.length).toBe(0);\n  });\n\n  test('it should return validation warnings when adding additional properties to the attribute field', () => {\n    // Arrange\n    const validator = new Validator();\n    const schema = validator.getSchema(defaultSchemaVersion);\n\n    const metadata = JSON.parse(JSON.stringify(validMetadata));\n    metadata.attributes = [\n      { checksum: 'randomchecksum', trait_type: 'Background', value: 'Yellow' },\n      { checksum: 'randomchecksum', trait_type: 'Fur', value: 'Gold' },\n    ];\n\n    // Act\n    const schemaProblems = schemaValidator(metadata, schema);\n\n    // Assert\n    expect(schemaProblems.warnings.length).toBe(2);\n    expect(schemaProblems.errors.length).toBe(0);\n    expect(schemaProblems.warnings[0].type).toBe('schema');\n    expect(schemaProblems.warnings[0].msg).toBe(\"is not allowed to have the additional property 'checksum'\");\n    expect(schemaProblems.warnings[0].path).toBe('instance.attributes[0]');\n  });\n\n  test('it should return validation errors when not providing required properties for the attributes field', () => {\n    // Arrange\n    const validator = new Validator();\n    const schema = validator.getSchema(defaultSchemaVersion);\n\n    const metadata = JSON.parse(JSON.stringify(validMetadata));\n    metadata.attributes = [\n      { trait_type: 'Background' }, // no value property\n    ];\n\n    // Act\n    const schemaProblems = schemaValidator(metadata, schema);\n\n    // Assert\n    expect(schemaProblems.warnings.length).toBe(0);\n    expect(schemaProblems.errors.length).toBe(1);\n    expect(schemaProblems.errors[0].type).toBe('schema');\n    expect(schemaProblems.errors[0].msg).toBe(\"requires property 'value'\");\n    expect(schemaProblems.errors[0].path).toBe('instance.attributes[0]');\n  });\n});\n"],"mappings":"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","ignoreList":[]}