{"version":3,"file":"aws-service.js","names":["_dictionary","require","_magicBytes","_errorToMessage","_clientS","_libStorage","AWSService","constructor","awsAccessKeyId","awsSecretAccessKey","awsS3Region","awsS3Bucket","client","S3Client","credentials","accessKeyId","secretAccessKey","region","uploadFile","file","buffer","Uint8Array","arrayBuffer","fileTypeFromBufferInstance","filetypename","fileName","Date","now","toString","res","Upload","params","ACL","Bucket","Key","Body","ContentType","type","tags","queueSize","partSize","leavePartsOnError","resDone","done","Location","Error","dictionary","errors","awsUploadIssue","error","awsUploadingError","errorToMessage","exports"],"sources":["../../../../../src/services/file-storages/aws/aws-service.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2024 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport type { Blob } from 'buffer';\nimport { dictionary } from '../../../utils/constants/dictionary';\nimport { filetypename } from 'magic-bytes.js';\nimport { errorToMessage } from '../../../helpers/error-to-message';\nimport { S3Client } from '@aws-sdk/client-s3';\nimport { Upload } from '@aws-sdk/lib-storage';\nimport { FileStorage } from '../../../types/file-storage-service';\n\nexport class AWSService implements FileStorage {\n  public client: S3Client;\n  public awsAccessKeyId?: string;\n  public awsSecretAccessKey?: string;\n  public awsS3Region?: string;\n  public awsS3Bucket?: string;\n\n  constructor(awsAccessKeyId: string, awsSecretAccessKey: string, awsS3Region: string, awsS3Bucket: string) {\n    this.awsAccessKeyId = awsAccessKeyId;\n    this.awsSecretAccessKey = awsSecretAccessKey;\n    this.awsS3Region = awsS3Region;\n    this.awsS3Bucket = awsS3Bucket;\n\n    this.client = new S3Client({\n      credentials: {\n        accessKeyId: this.awsAccessKeyId,\n        secretAccessKey: this.awsSecretAccessKey,\n      },\n      region: this.awsS3Region,\n    });\n  }\n\n  public async uploadFile(file: Blob): Promise<string> {\n    const buffer = new Uint8Array(await file.arrayBuffer());\n    const fileTypeFromBufferInstance = filetypename(buffer);\n\n    const fileName = `${Date.now().toString()}.${fileTypeFromBufferInstance[0] ?? 'json'}`;\n\n    try {\n      const res = new Upload({\n        client: this.client,\n        params: {\n          ACL: 'public-read',\n          Bucket: this.awsS3Bucket,\n          Key: fileName,\n          Body: buffer,\n          ContentType: file.type || 'application/octet-stream', // Set the Content-Type header\n        },\n        tags: [],\n        queueSize: 4,\n        partSize: 1024 * 1024 * 5, // Maximum part size is 5MB\n        leavePartsOnError: false, // optional manually handle dropped parts\n      });\n\n      const resDone = await res.done();\n\n      if (!resDone || !resDone.Location) {\n        throw new Error(dictionary.errors.awsUploadIssue);\n      }\n\n      return resDone.Location;\n    } catch (error) {\n      throw new Error(dictionary.errors.awsUploadingError(errorToMessage(error)));\n    }\n  }\n}\n"],"mappings":";;;;;;AAoBA,IAAAA,WAAA,GAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AACA,IAAAE,eAAA,GAAAF,OAAA;AACA,IAAAG,QAAA,GAAAH,OAAA;AACA,IAAAI,WAAA,GAAAJ,OAAA;AAxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AASO,MAAMK,UAAU,CAAwB;EAO7CC,WAAWA,CAACC,cAAsB,EAAEC,kBAA0B,EAAEC,WAAmB,EAAEC,WAAmB,EAAE;IACxG,IAAI,CAACH,cAAc,GAAGA,cAAc;IACpC,IAAI,CAACC,kBAAkB,GAAGA,kBAAkB;IAC5C,IAAI,CAACC,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACC,WAAW,GAAGA,WAAW;IAE9B,IAAI,CAACC,MAAM,GAAG,IAAIC,iBAAQ,CAAC;MACzBC,WAAW,EAAE;QACXC,WAAW,EAAE,IAAI,CAACP,cAAc;QAChCQ,eAAe,EAAE,IAAI,CAACP;MACxB,CAAC;MACDQ,MAAM,EAAE,IAAI,CAACP;IACf,CAAC,CAAC;EACJ;EAEA,MAAaQ,UAAUA,CAACC,IAAU,EAAmB;IACnD,MAAMC,MAAM,GAAG,IAAIC,UAAU,CAAC,MAAMF,IAAI,CAACG,WAAW,CAAC,CAAC,CAAC;IACvD,MAAMC,0BAA0B,GAAG,IAAAC,wBAAY,EAACJ,MAAM,CAAC;IAEvD,MAAMK,QAAQ,GAAI,GAAEC,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAE,IAAGL,0BAA0B,CAAC,CAAC,CAAC,IAAI,MAAO,EAAC;IAEtF,IAAI;MACF,MAAMM,GAAG,GAAG,IAAIC,kBAAM,CAAC;QACrBlB,MAAM,EAAE,IAAI,CAACA,MAAM;QACnBmB,MAAM,EAAE;UACNC,GAAG,EAAE,aAAa;UAClBC,MAAM,EAAE,IAAI,CAACtB,WAAW;UACxBuB,GAAG,EAAET,QAAQ;UACbU,IAAI,EAAEf,MAAM;UACZgB,WAAW,EAAEjB,IAAI,CAACkB,IAAI,IAAI,0BAA0B,CAAE;QACxD,CAAC;QACDC,IAAI,EAAE,EAAE;QACRC,SAAS,EAAE,CAAC;QACZC,QAAQ,EAAE,IAAI,GAAG,IAAI,GAAG,CAAC;QAAE;QAC3BC,iBAAiB,EAAE,KAAK,CAAE;MAC5B,CAAC,CAAC;MAEF,MAAMC,OAAO,GAAG,MAAMb,GAAG,CAACc,IAAI,CAAC,CAAC;MAEhC,IAAI,CAACD,OAAO,IAAI,CAACA,OAAO,CAACE,QAAQ,EAAE;QACjC,MAAM,IAAIC,KAAK,CAACC,sBAAU,CAACC,MAAM,CAACC,cAAc,CAAC;MACnD;MAEA,OAAON,OAAO,CAACE,QAAQ;IACzB,CAAC,CAAC,OAAOK,KAAK,EAAE;MACd,MAAM,IAAIJ,KAAK,CAACC,sBAAU,CAACC,MAAM,CAACG,iBAAiB,CAAC,IAAAC,8BAAc,EAACF,KAAK,CAAC,CAAC,CAAC;IAC7E;EACF;AACF;AAACG,OAAA,CAAA9C,UAAA,GAAAA,UAAA","ignoreList":[]}