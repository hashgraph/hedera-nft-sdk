{"version":3,"file":"upload-service.browser.js","names":["filter","isNull","map","dictionary","errorToMessage","UploadService","constructor","service","uploadFilesFromPath","_","Error","uploadBlobFiles","handleBlobUpload","metadata","errors","uploadService","noMetadata","file","Blob","JSON","stringify","type","url","uploadFile","content","e","errorMessage","uploadMetadataList","metadatas","metadataUris","Promise","all","metadataUri"],"sources":["../../../src/services/upload-service.browser.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2024 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport filter from 'lodash/filter';\nimport isNull from 'lodash/isNull';\nimport map from 'lodash/map';\nimport { BufferFile } from '../types/buffer-file';\nimport { dictionary } from '../utils/constants/dictionary';\nimport { errorToMessage } from '../helpers/error-to-message';\nimport { NFTMetadata } from '../types/nft-metadata';\nimport { FileStorage } from '../types/file-storage-service';\n\nexport type FileStorageURL = `https://${string}/`;\nexport type FileStorageUploadUrl = string;\ntype UploadServiceReturn = {\n  content: Blob | BufferFile;\n  url: string;\n};\n\nexport class UploadService {\n  private service: FileStorage;\n\n  constructor(service: FileStorage) {\n    this.service = service;\n  }\n\n  public async uploadFilesFromPath(_: string[]): Promise<UploadServiceReturn[]> {\n    throw new Error(\"Not implemented in browser\");\n  }\n\n  public async uploadBlobFiles(_: (Blob | BufferFile)[]): Promise<UploadServiceReturn[]> {\n    throw new Error(\"Not implemented in browser\");\n  }\n\n  public async handleBlobUpload(metadata: Partial<NFTMetadata> | NFTMetadata): Promise<UploadServiceReturn | null> {\n    if (!metadata) {\n      throw new Error(dictionary.errors.uploadService.noMetadata);\n    }\n\n    try {\n      const file = new Blob([JSON.stringify(metadata)], { type: 'application/json' });\n      // @ts-expect-error Argument of type 'Blob' is assignable to parameter of type 'import(\"buffer\").Blob\n      const url = await this.service.uploadFile(file);\n\n      return {\n        content: file,\n        url,\n      };\n    } catch (e) {\n      const errorMessage = errorToMessage(e);\n\n      throw new Error(errorMessage);\n    }\n  }\n\n  public async uploadMetadataList(metadatas: NFTMetadata[]): Promise<UploadServiceReturn[]> {\n    const metadataUris = await Promise.all(map(metadatas, async (metadata) => this.handleBlobUpload(metadata)));\n\n    return filter(metadataUris, (metadataUri): metadataUri is UploadServiceReturn => !isNull(metadataUri));\n  }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,MAAM,MAAM,eAAe;AAClC,OAAOC,MAAM,MAAM,eAAe;AAClC,OAAOC,GAAG,MAAM,YAAY;AAE5B,SAASC,UAAU,QAAQ,+BAA+B;AAC1D,SAASC,cAAc,QAAQ,6BAA6B;AAW5D,OAAO,MAAMC,aAAa,CAAC;EAGzBC,WAAWA,CAACC,OAAoB,EAAE;IAChC,IAAI,CAACA,OAAO,GAAGA,OAAO;EACxB;EAEA,MAAaC,mBAAmBA,CAACC,CAAW,EAAkC;IAC5E,MAAM,IAAIC,KAAK,CAAC,4BAA4B,CAAC;EAC/C;EAEA,MAAaC,eAAeA,CAACF,CAAwB,EAAkC;IACrF,MAAM,IAAIC,KAAK,CAAC,4BAA4B,CAAC;EAC/C;EAEA,MAAaE,gBAAgBA,CAACC,QAA4C,EAAuC;IAC/G,IAAI,CAACA,QAAQ,EAAE;MACb,MAAM,IAAIH,KAAK,CAACP,UAAU,CAACW,MAAM,CAACC,aAAa,CAACC,UAAU,CAAC;IAC7D;IAEA,IAAI;MACF,MAAMC,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACC,IAAI,CAACC,SAAS,CAACP,QAAQ,CAAC,CAAC,EAAE;QAAEQ,IAAI,EAAE;MAAmB,CAAC,CAAC;MAC/E;MACA,MAAMC,GAAG,GAAG,MAAM,IAAI,CAACf,OAAO,CAACgB,UAAU,CAACN,IAAI,CAAC;MAE/C,OAAO;QACLO,OAAO,EAAEP,IAAI;QACbK;MACF,CAAC;IACH,CAAC,CAAC,OAAOG,CAAC,EAAE;MACV,MAAMC,YAAY,GAAGtB,cAAc,CAACqB,CAAC,CAAC;MAEtC,MAAM,IAAIf,KAAK,CAACgB,YAAY,CAAC;IAC/B;EACF;EAEA,MAAaC,kBAAkBA,CAACC,SAAwB,EAAkC;IACxF,MAAMC,YAAY,GAAG,MAAMC,OAAO,CAACC,GAAG,CAAC7B,GAAG,CAAC0B,SAAS,EAAE,MAAOf,QAAQ,IAAK,IAAI,CAACD,gBAAgB,CAACC,QAAQ,CAAC,CAAC,CAAC;IAE3G,OAAOb,MAAM,CAAC6B,YAAY,EAAGG,WAAW,IAAyC,CAAC/B,MAAM,CAAC+B,WAAW,CAAC,CAAC;EACxG;AACF","ignoreList":[]}