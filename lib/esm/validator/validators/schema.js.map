{"version":3,"file":"schema.js","names":["Validator","validator","additionalPropertyMsg","distilProblems","problems","warnings","errors","reduce","acc","problem","message","includes","push","schemaValidator","instance","schema","result","validate","distilledProblems","map","error","type","msg","replace","path","property","warning"],"sources":["../../../../src/validator/validators/schema.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2023 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport { Validator, ValidationError } from 'jsonschema';\nconst validator = new Validator();\n\nimport { Instance, ValidationResult } from '../../types/validator';\n\nconst additionalPropertyMsg = 'is not allowed to have the additional property';\n\n/**\n * Distil an errors array from JSON schema into errors and warnings.\n * We want to separate \"additional property\" errors into warnings because they don't influence the further validatin of the JSON object.\n *\n * @param {ValidationError[]} problems - Errors array from jsonschema\n */\nconst distilProblems = (problems: ValidationError[]) => {\n  const { warnings, errors } = problems.reduce<{ warnings: ValidationError[]; errors: ValidationError[] }>(\n    (acc, problem) => {\n      if (problem.message.includes(additionalPropertyMsg)) {\n        acc.warnings.push(problem);\n      } else {\n        acc.errors.push(problem);\n      }\n      return acc;\n    },\n    { warnings: [], errors: [] }\n  );\n\n  return {\n    warnings,\n    errors,\n  };\n};\n\n/**\n * The schema validator validates the {instance} against a specific version of the HIP412 metadata standard using jsonschema\n *\n * @see https://github.com/hashgraph/hedera-improvement-proposal/blob/main/HIP/hip-412.md#default-schema-collectibe-hedera-nfts-format-hip412100\n *\n * @param {Object} instance - The JSON object to validate against a schema\n * @param {Object} schema - The schema to validate the {instance} against\n * @returns {ValidationResult} - Contains no, one, or multiple error objects that describe errors for the validated {instance}\n */\nconst schemaValidator = (instance: Instance, schema: Object): ValidationResult => {\n  const result = validator.validate(instance, schema);\n  const distilledProblems = distilProblems(result.errors);\n\n  const errors = distilledProblems.errors.map((error) => ({\n    type: 'schema',\n    msg: error.message.replace(/\\\"/g, \"'\"),\n    path: error.property,\n  }));\n\n  const warnings = distilledProblems.warnings.map((warning) => ({\n    type: 'schema',\n    msg: warning.message.replace(/\\\"/g, \"'\"),\n    path: warning.property,\n  }));\n\n  return {\n    errors,\n    warnings,\n  };\n};\n\nexport { schemaValidator };\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,SAAS,QAAyB,YAAY;AACvD,MAAMC,SAAS,GAAG,IAAID,SAAS,CAAC,CAAC;AAIjC,MAAME,qBAAqB,GAAG,gDAAgD;;AAE9E;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,cAAc,GAAIC,QAA2B,IAAK;EACtD,MAAM;IAAEC,QAAQ;IAAEC;EAAO,CAAC,GAAGF,QAAQ,CAACG,MAAM,CAC1C,CAACC,GAAG,EAAEC,OAAO,KAAK;IAChB,IAAIA,OAAO,CAACC,OAAO,CAACC,QAAQ,CAACT,qBAAqB,CAAC,EAAE;MACnDM,GAAG,CAACH,QAAQ,CAACO,IAAI,CAACH,OAAO,CAAC;IAC5B,CAAC,MAAM;MACLD,GAAG,CAACF,MAAM,CAACM,IAAI,CAACH,OAAO,CAAC;IAC1B;IACA,OAAOD,GAAG;EACZ,CAAC,EACD;IAAEH,QAAQ,EAAE,EAAE;IAAEC,MAAM,EAAE;EAAG,CAC7B,CAAC;EAED,OAAO;IACLD,QAAQ;IACRC;EACF,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMO,eAAe,GAAGA,CAACC,QAAkB,EAAEC,MAAc,KAAuB;EAChF,MAAMC,MAAM,GAAGf,SAAS,CAACgB,QAAQ,CAACH,QAAQ,EAAEC,MAAM,CAAC;EACnD,MAAMG,iBAAiB,GAAGf,cAAc,CAACa,MAAM,CAACV,MAAM,CAAC;EAEvD,MAAMA,MAAM,GAAGY,iBAAiB,CAACZ,MAAM,CAACa,GAAG,CAAEC,KAAK,KAAM;IACtDC,IAAI,EAAE,QAAQ;IACdC,GAAG,EAAEF,KAAK,CAACV,OAAO,CAACa,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;IACtCC,IAAI,EAAEJ,KAAK,CAACK;EACd,CAAC,CAAC,CAAC;EAEH,MAAMpB,QAAQ,GAAGa,iBAAiB,CAACb,QAAQ,CAACc,GAAG,CAAEO,OAAO,KAAM;IAC5DL,IAAI,EAAE,QAAQ;IACdC,GAAG,EAAEI,OAAO,CAAChB,OAAO,CAACa,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;IACxCC,IAAI,EAAEE,OAAO,CAACD;EAChB,CAAC,CAAC,CAAC;EAEH,OAAO;IACLnB,MAAM;IACND;EACF,CAAC;AACH,CAAC;AAED,SAASQ,eAAe","ignoreList":[]}