{"version":3,"file":"storage-provider-e2e.test.js","names":["fs","UploadService","NftStorageService","PinataService","MockStorageService","awsSecretKey","awsAccessKey","nftStorageApiKey","pinataApiKey","pinataJwtKey","pinataSecretApiKey","LONG_E2E_TIMEOUT","exampleNFTMetadata","AWSService","itif","condition","it","skip","describe","filePath","fileBuffer","blob","beforeAll","readFileSync","Blob","awsStorageConfig","uploadService","result","uploadBlobFiles","expect","content","toEqual","url","toBeDefined","toHaveLength","uploadFilesFromPath","uploadMetadataList","nftStorageConfig","pinataStorageConfig","mockStorageConfig"],"sources":["../../../../src/test/e2e/storage-provider-e2e.test.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2024 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport fs from 'fs';\nimport { UploadService } from '../../services/upload-service';\nimport { NftStorageService } from '../../services/file-storages/nft-storage/nft-storage-service';\nimport { PinataService } from '../../services/file-storages/pinata/pinata-service';\nimport { MockStorageService } from '../../services/file-storages/mock-storage/mock-storage-service';\nimport { awsSecretKey, awsAccessKey, nftStorageApiKey, pinataApiKey, pinataJwtKey, pinataSecretApiKey } from './e2e-consts';\nimport { LONG_E2E_TIMEOUT } from '../__mocks__/consts';\nimport { exampleNFTMetadata } from '../__mocks__/exampleNFTMetadata';\nimport { AWSService } from '../../services/file-storages/aws/aws-service';\n\nconst itif = (condition: any) => (condition ? it : it.skip);\n\ndescribe('UploadService E2E Test', () => {\n  let filePath: string;\n  let fileBuffer: Buffer;\n  let blob: Blob;\n\n  beforeAll(() => {\n    filePath = 'src/test/__mocks__/exampleFiles/photo.jpeg';\n    fileBuffer = fs.readFileSync(filePath);\n    blob = new Blob([fileBuffer]);\n  });\n\n  itif(awsAccessKey && awsSecretKey)(\n    'should upload files successfully using AWSService',\n    async () => {\n      const awsStorageConfig = new AWSService(awsAccessKey, awsSecretKey, 'eu-central-1', 'hederatest');\n      const uploadService = new UploadService(awsStorageConfig);\n      const result = await uploadService.uploadBlobFiles([blob]);\n\n      expect(result[0].content).toEqual(blob);\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  itif(awsAccessKey && awsSecretKey)(\n    'should upload file by path successfully using AWSService',\n    async () => {\n      const awsStorageConfig = new AWSService(awsAccessKey, awsSecretKey, 'eu-central-1', 'hederatest');\n      const uploadService = new UploadService(awsStorageConfig);\n      const result = await uploadService.uploadFilesFromPath([filePath]);\n\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  itif(awsAccessKey && awsSecretKey)(\n    'should upload files by path directory successfully using AWSService',\n    async () => {\n      const awsStorageConfig = new AWSService(awsAccessKey, awsSecretKey, 'eu-central-1', 'hederatest');\n      const uploadService = new UploadService(awsStorageConfig);\n      const result = await uploadService.uploadFilesFromPath(['src/test/__mocks__/exampleFiles']);\n\n      expect(result[0].url).toBeDefined();\n      expect(result[1].url).toBeDefined();\n      expect(result).toHaveLength(2);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  itif(awsAccessKey && awsSecretKey)(\n    'should upload metadata successfully using AWSService',\n    async () => {\n      const awsStorageConfig = new AWSService(awsAccessKey, awsSecretKey, 'eu-central-1', 'hederatest');\n      const uploadService = new UploadService(awsStorageConfig);\n      const result = await uploadService.uploadMetadataList([exampleNFTMetadata]);\n\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload files successfully using NftStorageService',\n    async () => {\n      const nftStorageConfig = new NftStorageService('https://api.nft.storage/', 'upload', [nftStorageApiKey]);\n      const uploadService = new UploadService(nftStorageConfig);\n      const result = await uploadService.uploadBlobFiles([blob]);\n\n      expect(result[0].content).toEqual(blob);\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload file by path successfully using NftStorageService',\n    async () => {\n      const nftStorageConfig = new NftStorageService('https://api.nft.storage/', 'upload', [nftStorageApiKey]);\n      const uploadService = new UploadService(nftStorageConfig);\n      const result = await uploadService.uploadFilesFromPath([filePath]);\n\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload files by path directory successfully using NftStorageService',\n    async () => {\n      const nftStorageConfig = new NftStorageService('https://api.nft.storage/', 'upload', [nftStorageApiKey]);\n      const uploadService = new UploadService(nftStorageConfig);\n      const result = await uploadService.uploadFilesFromPath(['src/test/__mocks__/exampleFiles']);\n\n      expect(result[0].url).toBeDefined();\n      expect(result[1].url).toBeDefined();\n      expect(result).toHaveLength(2);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload metadata successfully using NftStorageService',\n    async () => {\n      const nftStorageConfig = new NftStorageService('https://api.nft.storage/', 'upload', [nftStorageApiKey]);\n      const uploadService = new UploadService(nftStorageConfig);\n      const result = await uploadService.uploadMetadataList([exampleNFTMetadata]);\n\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload files successfully using PinataService',\n    async () => {\n      const pinataStorageConfig = new PinataService(pinataJwtKey, pinataApiKey, pinataSecretApiKey);\n      const uploadService = new UploadService(pinataStorageConfig);\n      const result = await uploadService.uploadBlobFiles([blob]);\n\n      expect(result[0].content).toEqual(blob);\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload file by path successfully using PinataService',\n    async () => {\n      const pinataStorageConfig = new PinataService(pinataJwtKey, pinataApiKey, pinataSecretApiKey);\n      const uploadService = new UploadService(pinataStorageConfig);\n      const result = await uploadService.uploadFilesFromPath([filePath]);\n\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload files by path directory successfully using PinataService',\n    async () => {\n      const pinataStorageConfig = new PinataService(pinataJwtKey, pinataApiKey, pinataSecretApiKey);\n      const uploadService = new UploadService(pinataStorageConfig);\n      const result = await uploadService.uploadFilesFromPath(['src/test/__mocks__/exampleFiles']);\n\n      expect(result[0].url).toBeDefined();\n      expect(result[1].url).toBeDefined();\n      expect(result).toHaveLength(2);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload metadata successfully using PinataService',\n    async () => {\n      const pinataStorageConfig = new PinataService(pinataJwtKey, pinataApiKey, pinataSecretApiKey);\n      const uploadService = new UploadService(pinataStorageConfig);\n      const result = await uploadService.uploadMetadataList([exampleNFTMetadata]);\n\n      expect(result[0].url).toBeDefined();\n      expect(result).toHaveLength(1);\n    },\n    LONG_E2E_TIMEOUT\n  );\n\n  it(\n    'should upload files successfully using MockStorageService',\n    async () => {\n      const mockStorageConfig = new MockStorageService('https://www.mockstorage.com/');\n      const uploadService = new UploadService(mockStorageConfig);\n      const result = await uploadService.uploadBlobFiles([blob]);\n      expect(result).toBeDefined();\n      expect(result[0].url).toEqual('https://www.mockstorage.com/');\n    },\n    LONG_E2E_TIMEOUT\n  );\n});\n"],"mappings":"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","ignoreList":[]}