{"version":3,"file":"calculate-risk-score-from-token-id.test.js","names":["calculateRiskScoreFromTokenId","axios","exampleMetadata","metadataWihAllKeysProvided","PrivateKey","jest","mock","describe","mockAxios","beforeEach","get","mockClear","it","mockResolvedValueOnce","riskScore","riskLevel","riskScoreFactors","tokenId","network","expect","toBe","toEqual","supply_key","customWeights","keys","admin_key","wipe_key","freeze_key","kyc_key","pause_key","fee_schedule_key","properties","supply_type_infinite","customRiskLevels","NORISK","LOW","MEDIUM","HIGH","metadataWithAdminKey","data","generateED25519","max_supply","total_supply","max_supply_equal_to_total_supply"],"sources":["../../../../../src/test/unit/risk-score/calculate-risk-score-from-token-id.test.ts"],"sourcesContent":["/*-\n *\n * Hedera NFT SDK\n *\n * Copyright (C) 2023 Hedera Hashgraph, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport { calculateRiskScoreFromTokenId } from '../../../risk';\nimport axios from 'axios';\nimport { exampleMetadata, metadataWihAllKeysProvided } from '../../__mocks__/exampleMetadata';\nimport { RiskLevels, Weights } from '../../../types/risk';\nimport { PrivateKey } from '@hashgraph/sdk';\n\njest.mock('axios');\n\ndescribe('calculateRiskScoreFromTokenId', () => {\n  let mockAxios: jest.Mocked<typeof axios>;\n\n  beforeEach(() => {\n    mockAxios = axios as jest.Mocked<typeof axios>;\n    mockAxios.get.mockClear();\n  });\n\n  it('should calculate risk score for a given token ID', async () => {\n    mockAxios.get.mockResolvedValueOnce(exampleMetadata);\n\n    const { riskScore, riskLevel, riskScoreFactors } = await calculateRiskScoreFromTokenId({ tokenId: '0.0.123456', network: 'testnet' });\n\n    expect(riskScore).toBe(20);\n    expect(riskLevel).toBe('LOW');\n    expect(riskScoreFactors).toEqual({ supply_key: 20 });\n  });\n\n  it('should calculate risk score for a given token ID with customWeights parameter', async () => {\n    mockAxios.get.mockResolvedValueOnce(exampleMetadata);\n\n    const customWeights: Weights = {\n      keys: {\n        admin_key: 20,\n        wipe_key: 20,\n        freeze_key: 5,\n        supply_key: 2,\n        kyc_key: 5,\n        pause_key: 5,\n        fee_schedule_key: 4,\n      },\n      properties: {\n        supply_type_infinite: 20,\n      },\n    };\n\n    const { riskScore, riskLevel, riskScoreFactors } = await calculateRiskScoreFromTokenId({\n      tokenId: '0.0.123456',\n      network: 'testnet',\n      customWeights,\n    });\n    expect(riskScore).toBe(2);\n    expect(riskLevel).toBe('LOW');\n    expect(riskScoreFactors).toEqual({ supply_key: 2 });\n  });\n\n  it('should calculate risk score for a given token ID with customWeights and customRiskLevels parameters', async () => {\n    mockAxios.get.mockResolvedValueOnce(exampleMetadata);\n\n    const customWeights: Weights = {\n      keys: {\n        admin_key: 500,\n        wipe_key: 500,\n        freeze_key: 100,\n        supply_key: 250,\n        kyc_key: 50,\n        pause_key: 50,\n        fee_schedule_key: 40,\n      },\n      properties: {\n        supply_type_infinite: 200,\n      },\n    };\n\n    const customRiskLevels: RiskLevels = {\n      NORISK: 5,\n      LOW: 60,\n      MEDIUM: 100,\n      HIGH: 200,\n    };\n\n    const { riskScore, riskLevel, riskScoreFactors } = await calculateRiskScoreFromTokenId({\n      tokenId: '0.0.123456',\n      network: 'testnet',\n      customWeights,\n      customRiskLevels,\n    });\n\n    expect(riskScore).toBe(250);\n    expect(riskLevel).toBe('HIGH');\n    expect(riskScoreFactors).toEqual({ supply_key: 250 });\n  });\n\n  it('should calculate risk score for a given token ID with admin_key provided', async () => {\n    const metadataWithAdminKey = {\n      data: {\n        ...exampleMetadata.data,\n        admin_key: PrivateKey.generateED25519(),\n      },\n    };\n    mockAxios.get.mockResolvedValueOnce(metadataWithAdminKey);\n\n    const { riskScore, riskLevel, riskScoreFactors } = await calculateRiskScoreFromTokenId({ tokenId: '0.0.123456', network: 'testnet' });\n\n    expect(riskScore).toBe(220);\n    expect(riskLevel).toBe('HIGH');\n    expect(riskScoreFactors).toEqual({ supply_key: 20, admin_key: 200 });\n  });\n\n  it('should calculate risk score for a given token ID with max_supply and total_supply equal', async () => {\n    const metadataWithAdminKey = {\n      data: {\n        ...exampleMetadata.data,\n        max_supply: 100,\n        total_supply: 100,\n        admin_key: PrivateKey.generateED25519(),\n      },\n    };\n    mockAxios.get.mockResolvedValueOnce(metadataWithAdminKey);\n\n    const { riskScore, riskLevel, riskScoreFactors } = await calculateRiskScoreFromTokenId({ tokenId: '0.0.123456', network: 'testnet' });\n\n    expect(riskScore).toBe(200);\n    expect(riskLevel).toBe('HIGH');\n    expect(riskScoreFactors).toEqual({ supply_key: 20, admin_key: 200, max_supply_equal_to_total_supply: -20 });\n  });\n\n  it('should calculate risk score for a given token ID with all keys provided, customWeights & customRiskLevels parameters', async () => {\n    mockAxios.get.mockResolvedValueOnce(metadataWihAllKeysProvided);\n\n    const customWeights: Weights = {\n      keys: {\n        admin_key: 500,\n        wipe_key: 500,\n        freeze_key: 100,\n        supply_key: 250,\n        kyc_key: 50,\n        pause_key: 50,\n        fee_schedule_key: 50,\n      },\n      properties: {\n        supply_type_infinite: 200,\n      },\n    };\n\n    const customRiskLevels: RiskLevels = {\n      NORISK: 20,\n      LOW: 100,\n      MEDIUM: 500,\n      HIGH: 1000,\n    };\n\n    const { riskScore, riskLevel, riskScoreFactors } = await calculateRiskScoreFromTokenId({\n      tokenId: '0.0.123456',\n      network: 'testnet',\n      customWeights,\n      customRiskLevels,\n    });\n    expect(riskScore).toBe(1500);\n    expect(riskLevel).toBe('HIGH');\n    expect(riskScoreFactors).toEqual({\n      supply_key: 250,\n      kyc_key: 50,\n      admin_key: 500,\n      fee_schedule_key: 50,\n      freeze_key: 100,\n      pause_key: 50,\n      wipe_key: 500,\n    });\n  });\n});\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,6BAA6B,QAAQ,eAAe;AAC7D,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,eAAe,EAAEC,0BAA0B,QAAQ,iCAAiC;AAE7F,SAASC,UAAU,QAAQ,gBAAgB;AAE3CC,IAAI,CAACC,IAAI,CAAC,OAAO,CAAC;AAElBC,QAAQ,CAAC,+BAA+B,EAAE,MAAM;EAC9C,IAAIC,SAAoC;EAExCC,UAAU,CAAC,MAAM;IACfD,SAAS,GAAGP,KAAkC;IAC9CO,SAAS,CAACE,GAAG,CAACC,SAAS,CAAC,CAAC;EAC3B,CAAC,CAAC;EAEFC,EAAE,CAAC,kDAAkD,EAAE,YAAY;IACjEJ,SAAS,CAACE,GAAG,CAACG,qBAAqB,CAACX,eAAe,CAAC;IAEpD,MAAM;MAAEY,SAAS;MAAEC,SAAS;MAAEC;IAAiB,CAAC,GAAG,MAAMhB,6BAA6B,CAAC;MAAEiB,OAAO,EAAE,YAAY;MAAEC,OAAO,EAAE;IAAU,CAAC,CAAC;IAErIC,MAAM,CAACL,SAAS,CAAC,CAACM,IAAI,CAAC,EAAE,CAAC;IAC1BD,MAAM,CAACJ,SAAS,CAAC,CAACK,IAAI,CAAC,KAAK,CAAC;IAC7BD,MAAM,CAACH,gBAAgB,CAAC,CAACK,OAAO,CAAC;MAAEC,UAAU,EAAE;IAAG,CAAC,CAAC;EACtD,CAAC,CAAC;EAEFV,EAAE,CAAC,+EAA+E,EAAE,YAAY;IAC9FJ,SAAS,CAACE,GAAG,CAACG,qBAAqB,CAACX,eAAe,CAAC;IAEpD,MAAMqB,aAAsB,GAAG;MAC7BC,IAAI,EAAE;QACJC,SAAS,EAAE,EAAE;QACbC,QAAQ,EAAE,EAAE;QACZC,UAAU,EAAE,CAAC;QACbL,UAAU,EAAE,CAAC;QACbM,OAAO,EAAE,CAAC;QACVC,SAAS,EAAE,CAAC;QACZC,gBAAgB,EAAE;MACpB,CAAC;MACDC,UAAU,EAAE;QACVC,oBAAoB,EAAE;MACxB;IACF,CAAC;IAED,MAAM;MAAElB,SAAS;MAAEC,SAAS;MAAEC;IAAiB,CAAC,GAAG,MAAMhB,6BAA6B,CAAC;MACrFiB,OAAO,EAAE,YAAY;MACrBC,OAAO,EAAE,SAAS;MAClBK;IACF,CAAC,CAAC;IACFJ,MAAM,CAACL,SAAS,CAAC,CAACM,IAAI,CAAC,CAAC,CAAC;IACzBD,MAAM,CAACJ,SAAS,CAAC,CAACK,IAAI,CAAC,KAAK,CAAC;IAC7BD,MAAM,CAACH,gBAAgB,CAAC,CAACK,OAAO,CAAC;MAAEC,UAAU,EAAE;IAAE,CAAC,CAAC;EACrD,CAAC,CAAC;EAEFV,EAAE,CAAC,qGAAqG,EAAE,YAAY;IACpHJ,SAAS,CAACE,GAAG,CAACG,qBAAqB,CAACX,eAAe,CAAC;IAEpD,MAAMqB,aAAsB,GAAG;MAC7BC,IAAI,EAAE;QACJC,SAAS,EAAE,GAAG;QACdC,QAAQ,EAAE,GAAG;QACbC,UAAU,EAAE,GAAG;QACfL,UAAU,EAAE,GAAG;QACfM,OAAO,EAAE,EAAE;QACXC,SAAS,EAAE,EAAE;QACbC,gBAAgB,EAAE;MACpB,CAAC;MACDC,UAAU,EAAE;QACVC,oBAAoB,EAAE;MACxB;IACF,CAAC;IAED,MAAMC,gBAA4B,GAAG;MACnCC,MAAM,EAAE,CAAC;MACTC,GAAG,EAAE,EAAE;MACPC,MAAM,EAAE,GAAG;MACXC,IAAI,EAAE;IACR,CAAC;IAED,MAAM;MAAEvB,SAAS;MAAEC,SAAS;MAAEC;IAAiB,CAAC,GAAG,MAAMhB,6BAA6B,CAAC;MACrFiB,OAAO,EAAE,YAAY;MACrBC,OAAO,EAAE,SAAS;MAClBK,aAAa;MACbU;IACF,CAAC,CAAC;IAEFd,MAAM,CAACL,SAAS,CAAC,CAACM,IAAI,CAAC,GAAG,CAAC;IAC3BD,MAAM,CAACJ,SAAS,CAAC,CAACK,IAAI,CAAC,MAAM,CAAC;IAC9BD,MAAM,CAACH,gBAAgB,CAAC,CAACK,OAAO,CAAC;MAAEC,UAAU,EAAE;IAAI,CAAC,CAAC;EACvD,CAAC,CAAC;EAEFV,EAAE,CAAC,0EAA0E,EAAE,YAAY;IACzF,MAAM0B,oBAAoB,GAAG;MAC3BC,IAAI,EAAE;QACJ,GAAGrC,eAAe,CAACqC,IAAI;QACvBd,SAAS,EAAErB,UAAU,CAACoC,eAAe,CAAC;MACxC;IACF,CAAC;IACDhC,SAAS,CAACE,GAAG,CAACG,qBAAqB,CAACyB,oBAAoB,CAAC;IAEzD,MAAM;MAAExB,SAAS;MAAEC,SAAS;MAAEC;IAAiB,CAAC,GAAG,MAAMhB,6BAA6B,CAAC;MAAEiB,OAAO,EAAE,YAAY;MAAEC,OAAO,EAAE;IAAU,CAAC,CAAC;IAErIC,MAAM,CAACL,SAAS,CAAC,CAACM,IAAI,CAAC,GAAG,CAAC;IAC3BD,MAAM,CAACJ,SAAS,CAAC,CAACK,IAAI,CAAC,MAAM,CAAC;IAC9BD,MAAM,CAACH,gBAAgB,CAAC,CAACK,OAAO,CAAC;MAAEC,UAAU,EAAE,EAAE;MAAEG,SAAS,EAAE;IAAI,CAAC,CAAC;EACtE,CAAC,CAAC;EAEFb,EAAE,CAAC,yFAAyF,EAAE,YAAY;IACxG,MAAM0B,oBAAoB,GAAG;MAC3BC,IAAI,EAAE;QACJ,GAAGrC,eAAe,CAACqC,IAAI;QACvBE,UAAU,EAAE,GAAG;QACfC,YAAY,EAAE,GAAG;QACjBjB,SAAS,EAAErB,UAAU,CAACoC,eAAe,CAAC;MACxC;IACF,CAAC;IACDhC,SAAS,CAACE,GAAG,CAACG,qBAAqB,CAACyB,oBAAoB,CAAC;IAEzD,MAAM;MAAExB,SAAS;MAAEC,SAAS;MAAEC;IAAiB,CAAC,GAAG,MAAMhB,6BAA6B,CAAC;MAAEiB,OAAO,EAAE,YAAY;MAAEC,OAAO,EAAE;IAAU,CAAC,CAAC;IAErIC,MAAM,CAACL,SAAS,CAAC,CAACM,IAAI,CAAC,GAAG,CAAC;IAC3BD,MAAM,CAACJ,SAAS,CAAC,CAACK,IAAI,CAAC,MAAM,CAAC;IAC9BD,MAAM,CAACH,gBAAgB,CAAC,CAACK,OAAO,CAAC;MAAEC,UAAU,EAAE,EAAE;MAAEG,SAAS,EAAE,GAAG;MAAEkB,gCAAgC,EAAE,CAAC;IAAG,CAAC,CAAC;EAC7G,CAAC,CAAC;EAEF/B,EAAE,CAAC,sHAAsH,EAAE,YAAY;IACrIJ,SAAS,CAACE,GAAG,CAACG,qBAAqB,CAACV,0BAA0B,CAAC;IAE/D,MAAMoB,aAAsB,GAAG;MAC7BC,IAAI,EAAE;QACJC,SAAS,EAAE,GAAG;QACdC,QAAQ,EAAE,GAAG;QACbC,UAAU,EAAE,GAAG;QACfL,UAAU,EAAE,GAAG;QACfM,OAAO,EAAE,EAAE;QACXC,SAAS,EAAE,EAAE;QACbC,gBAAgB,EAAE;MACpB,CAAC;MACDC,UAAU,EAAE;QACVC,oBAAoB,EAAE;MACxB;IACF,CAAC;IAED,MAAMC,gBAA4B,GAAG;MACnCC,MAAM,EAAE,EAAE;MACVC,GAAG,EAAE,GAAG;MACRC,MAAM,EAAE,GAAG;MACXC,IAAI,EAAE;IACR,CAAC;IAED,MAAM;MAAEvB,SAAS;MAAEC,SAAS;MAAEC;IAAiB,CAAC,GAAG,MAAMhB,6BAA6B,CAAC;MACrFiB,OAAO,EAAE,YAAY;MACrBC,OAAO,EAAE,SAAS;MAClBK,aAAa;MACbU;IACF,CAAC,CAAC;IACFd,MAAM,CAACL,SAAS,CAAC,CAACM,IAAI,CAAC,IAAI,CAAC;IAC5BD,MAAM,CAACJ,SAAS,CAAC,CAACK,IAAI,CAAC,MAAM,CAAC;IAC9BD,MAAM,CAACH,gBAAgB,CAAC,CAACK,OAAO,CAAC;MAC/BC,UAAU,EAAE,GAAG;MACfM,OAAO,EAAE,EAAE;MACXH,SAAS,EAAE,GAAG;MACdK,gBAAgB,EAAE,EAAE;MACpBH,UAAU,EAAE,GAAG;MACfE,SAAS,EAAE,EAAE;MACbH,QAAQ,EAAE;IACZ,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}